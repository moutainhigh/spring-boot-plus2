<!DOCTYPE html>
<html xmlns:th="http://www.springframework.org/schema/jdbc">
<head>
    <meta charset="utf-8">
    <title>兮家</title>
    <link rel="icon" href="/base/pic/icon/xijia.png" type="image/x-icon">           <!--在网页标题左侧显示图标-->
    <link rel="shortcut icon" href="/base/pic/icon/xijia.png" type="image/x-icon"> <!-- 在收藏夹显示图标-->
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <!-- 页面解析markdown为HTML显示需要的css -->
    <link rel="stylesheet" href="/components/editor/css/editormd.css">
    <script src='/base/js/jquery-3.4.1.min.js'></script>
    <script src="/base/js/app.js"></script>
    <script type="text/javascript" src="/components/editor/editormd.js"></script>

    <link rel="stylesheet" href="/components/editor/css/editormd.preview.min.css"/>
    <!-- markdown解析成HTML显示需要的js -->
    <script src="/components/editor/lib/marked.min.js"></script>
    <script src="/components/editor/lib/prettify.min.js"></script>
    <script src="/components/editor/lib/raphael.min.js"></script>
    <script src="/components/editor/lib/underscore.min.js"></script>
    <script src="/components/editor/lib/sequence-diagram.min.js"></script>
    <script src="/components/editor/lib/flowchart.min.js"></script>
    <script src="/components/editor/lib/jquery.flowchart.min.js"></script>

    <!-- jq 插件，鼠标效果 -->
    <!-- <script src="/components/fairy/js/batsCursor.js" type="text/javascript"></script>-->
    <!--  <script src=”js/fairyDustCursor.js” type=”text/javascript”></script>-->
    <!--  <script src=”js/emojiCursor.js” type=”text/javascript”></script>-->
    <!--  <script src=”js/bubbleCursor.js” type=”text/javascript”></script>-->
    <!--  <script src=”js/batsCursor.js” type=”text/javascript”></script>-->
    <!--  <script src=”js/snowflakeCursor.js” type=”text/javascript”></script>-->
</head>

<style>
    /* 一级菜单 */
    .oneTitle {
        cursor: pointer; /* 鼠标放到文字上显示手 */
        margin-top: 5%;
        margin-left: 10%;
        font-weight: bold; /*加粗*/
        font-size: 18px;
        border: 2px solid #ffffff; /* 每个标题边框 */
        width: 75%;
        /* 禁止复制 */
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    /* 二级菜单 */
    .twoTitle {
        cursor: pointer; /* 鼠标放到文字上显示手 */
        margin-left: 15%;
        font-size: 16px;
        margin-top: 2%;
        border: 2px solid #ffffff;
        width: 65%;
    }

    /* 数量小字 */
    .small-numbers {
        font-size: 12px;
        color: #ffc3b8;
    }

    /* 内容去背景色 */
    /*.markdownToHTML {*/
    /*    background-color: #ff666e !important;*/
    /*}*/

    /*滚动条样式 滚动条整体部分，可以设置宽度啥的*/
    .scrollBar::-webkit-scrollbar {
        width: 1px;
    }

    /*滚动条样式 滚动的滑块*/
    .scrollBar::-webkit-scrollbar-thumb {
        border-radius: 10px;
        -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        background: rgba(0, 0, 0, 0.2);
    }

    /*滚动条样式 外层轨道*/
    .scrollBar::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        border-radius: 0;
        background: rgba(0, 0, 0, 0.1);

    }

    .easyeditor-content ol, .easyeditor-content ul {
        /* 内容菜单，内容间隔的高,宽  */
        padding: 2px 20px;
    }
</style>
<body style="background-color:#e5e8ff;">


<div class="layui-container scrollBar" style="width:20%;height:92%;overflow-y:auto;background-color:#ffffff;display: block; position: fixed; top:2%; left:4%; text-decoration: none;">

    <div style="font-size: 25px;margin-left: 10%;margin-top: 2%;">兮家手册
        <span style="font-size: 16px;"> (0.x)</span>
    </div>
    <hr/>
    <!-- 左菜单区  -->
    <div id="helpMenu" style="">
        <!-- 动态获取 -->
        <!--        <div>-->
        <!--            <div class="oneTitle">一级目录</div>-->
        <!--            <div value="" class="twoTitle" onclick="getHelp(this)" onmouseover="place(this)" onmouseout="moveAway(this)">二级目录</div>-->
        <!--            <div class="twoTitle" onclick="getHelp(this)" onmouseover="place(this)" onmouseout="moveAway(this)">二级目录</div>-->
        <!--            <div class="twoTitle" onclick="getHelp(this)" onmouseover="place(this)" onmouseout="moveAway(this)">二级目录</div>-->
        <!--        </div>-->
    </div>
    <!-- 内容区  -->
    <div class="scrollBar" style="width:56.8%;height:100%;overflow-y:auto;background-color:#ffffff;display: block; position: fixed; top:2%; left:24.6%; text-decoration: none;">
        <!-- 页面解析markdown为HTML显示 -->
        <div id="markdownToHTML" style="width: 90%">
            <textarea id="content" style="display:none;" placeholder="markdown语言"></textarea>
        </div>
    </div>

    <!-- 文档菜单 -->
    <div class="scrollBar" style="width:18%;height:100%;overflow-y:auto;background-color:#ffffff;display: block; position: fixed; top:2%; left:82%; text-decoration: none;">
        <div id="contentTitle" class="easyeditor-content" style="margin-left: 5%">
            <!-- 动态生成标题菜单 -->
        </div>
    </div>
</div>
</body>

<script>


    // 选中色和对应的Rgb,不一致无法复制选中色
    let color = "#FF6E9C";
    let colorRgb = "rgb(255, 110, 156)";


    /**
     * 鼠标点击颜色处理 + 数据查询
     */
    function getHelp(ths, id) {
        //清除除选中的其他所有
        $(".twoTitle").css("color", "#000000");
        // 设置当前选中
        ths.style.color = color;
        // 查询数据，value = 数据id
        help(id)
    }

    /**
     * 鼠标放置样式,不是选中就赋值
     */
    function place(ths) {
        if (ths.style.color !== colorRgb) {
            ths.style.color = "#D855FF";
        }
    }

    /**
     * 鼠标移开样式,不是选中就赋值
     */
    function moveAway(ths) {
        if (ths.style.color !== colorRgb) {
            ths.style.color = "#000000";
        }
    }

    /**
     * 动态菜单
     */
    function initMenu() {
        let res = Ajax.get(path + "/admin/adminHelp/findTree");
        let helpMenuHtml = "";
        let data = res.data;
        for (let i = 0; i < data.length; i++) {
            let ybHelpTreeVOS = data[i].ybHelpTreeVOS;
            helpMenuHtml += "<div>";
            helpMenuHtml += "<div class='oneTitle' onclick='expandAndContract(" + i + "," + data.length + ")'>" + data[i].name + " <span class='small-numbers'>(" + ybHelpTreeVOS.length + ")</span></div>";
            if (ybHelpTreeVOS.length > 0) {
                for (let j = 0; j < ybHelpTreeVOS.length; j++) {
                    helpMenuHtml += "<div id='" + ybHelpTreeVOS[j].id + "' class='twoTitle twoTitle-" + i + "' onclick='getHelp(this,\"" + ybHelpTreeVOS[j].id + "\")' onmouseover='place(this)' onmouseout='moveAway(this)'>" + ybHelpTreeVOS[j].name + "</div>"

                }
            }
            helpMenuHtml += "</div>";
        }
        $("#helpMenu").html(helpMenuHtml);
        // 默认展开第一个
        expandAndContract(0, res.data.length);
        // 默认展示第一个列表的第一篇文章
        help(data[0].ybHelpTreeVOS[0].id);
        // 设置选中色
        let ss = $("#" + data[0].ybHelpTreeVOS[0].id).css("color", color);
    }


    /**
     * 加载文章
     */
    function help(id) {
        let res = Ajax.get(path + "/admin/adminHelp/findById?id=" + id);
        // 先清空，再添加 textarea 用于存放回显的 md 源码, 解决在弹出框中进行预览时，第二次预览无法刷新的问题
        $('#markdownToHTML').empty();
        $('#markdownToHTML').append('<textarea id="content" style="display:none;" placeholder="markdown语言"></textarea>');
        //
        $("#content").val(res.data.content); //.replaceAll(">", "&gt;").replaceAll("<", "&lt;")
        editormd.markdownToHTML("markdownToHTML", {
            htmlDecode: "style,script,iframe",
            emoji: true,  // 解析表情
            taskList: true,  // 解析列表
            tex: true,  // 默认不解析
            flowChart: true,  // 默认不解析
            sequenceDiagram: true  // 默认不解析
        });
        // 生成内容菜单
        GenerateContentList();
    }

    /**
     * 展示目录-展开，收缩
     * index = 当前选中
     * len = index 总数
     */
    var showIndex;  //当前选中
    var showState;  //当前选中是否已展开，已展开true
    var showTime = 300;   //展示收缩时间
    function expandAndContract(index, len) {
        if (showIndex === index) {
            if (showState) {
                // $(".twoTitle-" + index).hide(showTime);
                // $(".twoTitle-" + index).fadeOut(showTime);
                $(".twoTitle-" + index).slideUp(showTime);
                showState = false;
            } else {
                // $(".twoTitle-" + index).show(showTime);
                // $(".twoTitle-" + index).fadeIn(showTime);
                $(".twoTitle-" + index).slideDown(showTime);
                showState = true;
            }
        } else {
            //上次选中不是当前选中,展示
            // $(".twoTitle-" + index).show(showTime);
            // $(".twoTitle-" + index).fadeIn(showTime);
            $(".twoTitle-" + index).slideDown(showTime);
            showState = true;
        }
        // 关闭当前未选中的其他所有
        for (let i = 0; i < len; i++) {
            if (index !== i) {
                $(".twoTitle-" + i).hide(showTime);
            }
        }
        showIndex = index;
    }
</script>

<script language="javascript" type="text/javascript">
    //生成目录索引列表
    function GenerateContentList() {
        var content = '<a name="_labelTop"></a>';
        content += '<div id="navCategory">';
        content += '<p style="font-size:18px"><b>目录</b></p>';
        // 获取html
        var jquery_h1_list = $('#markdownToHTML h2');
        if (jquery_h1_list.length == 0) {
            $('#contentTitle').html(content);
            return;
        }
        // 一级目录 start
        content += '<ul class="first_class_ul">';
        for (var i = 0; i < jquery_h1_list.length; i++) {
            var go_to_top = '<div style="text-align: right"><a name="_label' + i + '"></a></div>';
            $(jquery_h1_list[i]).before(go_to_top);

            // 一级目录的一条
            var li_content = '<li><a href="#_label' + i + '" rel="external nofollow" rel="external nofollow" rel="external nofollow" rel="external nofollow" >' + $(jquery_h1_list[i]).text() + '</a></li>';

            var nextH1Index = i + 1;
            if (nextH1Index == jquery_h1_list.length) {
                nextH1Index = 0;
            }
            var jquery_h2_list = $(jquery_h1_list[i]).nextUntil(jquery_h1_list[nextH1Index], "h3");
            // 二级目录 start
            if (jquery_h2_list.length > 0) {
                //li_content +='<ul style="list-style-type:none; text-align: left; margin:2px 2px;">';
                li_content += '<ul class="second_class_ul">';
            }
            for (var j = 0; j < jquery_h2_list.length; j++) {
                var go_to_top2 = '<div style="text-align: right"><a name="_lab2_' + i + '_' + j + '"></a></div>';
                $(jquery_h2_list[j]).before(go_to_top2);
                // 二级目录的一条
                li_content += '<li ><a href="#_lab2_' + i + '_' + j + '" rel="external nofollow" >' + $(jquery_h2_list[j]).text() + '</a></li>';

                var nextH2Index = j + 1;
                var next;
                if (nextH2Index == jquery_h2_list.length) {
                    if (i + 1 == jquery_h1_list.length) {
                        next = jquery_h1_list[0];
                    } else {
                        next = jquery_h1_list[i + 1];
                    }
                } else {
                    next = jquery_h2_list[nextH2Index];
                }
                var jquery_h3_list = $(jquery_h2_list[j]).nextUntil(next, "h4");
                // 三级目录 start
                if (jquery_h3_list.length > 0) {
                    li_content += '<ul class="third_class_ul">';
                }
                for (var k = 0; k < jquery_h3_list.length; k++) {
                    var go_to_third_Content = '<div style="text-align: right"><a name="_label3_' + i + '_' + j + '_' + k + '"></a></div>';
                    $(jquery_h3_list[k]).before(go_to_third_Content);
                    // 三级目录的一条
                    li_content += '<li><a href="#_label3_' + i + '_' + j + '_' + k + '" rel="external nofollow" >' + $(jquery_h3_list[k]).text() + '</a></li>';
                }
                if (jquery_h3_list.length > 0) {
                    li_content += '</ul>';
                }
                li_content += '</li>';
                // 三级目录 end
            }
            if (jquery_h2_list.length > 0) {
                li_content += '</ul>';
            }
            li_content += '</li>';
            // 二级目录 end
            content += li_content;
        }
        // 一级目录 end
        content += '</ul>';
        content += '</div>';
        // $($('#content')[0]).prepend(content);
        // $($('#contentTitle')[0]).prepend(content);
        $('#contentTitle').html(content);
    }

    //GenerateContentList();

    // 加载菜单
    initMenu();

</script>
</html>


