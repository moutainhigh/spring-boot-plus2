<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ws.ldy.modules.yw.pets.mapper.PetsOrderMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.ws.ldy.modules.yw.pets.model.entity.PetsOrder">

        <result column="id" property="id"/>
        <result column="create_user" property="createUser"/>
        <result column="update_user" property="updateUser"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="deleted" property="deleted"/>
        <result column="version" property="version"/>
        <result column="user_id" property="userId"/>
        <result column="pet_id" property="petId"/>
        <result column="money" property="money"/>
        <result column="payment_base" property="paymentBase"/>
        <result column="pay_channel" property="payChannel"/>
        <result column="order_state" property="orderState"/>
        <result column="order_no" property="orderNo"/>
        <result column="business_type" property="businessType"/>
        <result column="business_desc" property="businessDesc"/>
    </resultMap>

    <!-- 通用查询结果列: <include refid="Base_Column_List"></include>  -->
    <sql id="Base_Column_List">

               id,
               create_user,
               update_user,
               create_time,
               update_time,
               deleted,
               version,
               user_id,
               pet_id,
               money,
               payment_base,
               pay_channel,
               order_state,
               order_no,
               order_wallet_no,
               refund_wallet_no,
               business_type,
               business_desc
        </sql>


    <select id="findClientPage" resultType="com.ws.ldy.modules.yw.pets.model.vo.PetsOrderClientPageVO">
           select
           o.id
           ,o.pay_time
           ,o.money
           ,o.pet_id as petId
           ,p.nickname as petNickname
           from t_pets_order o
           left join t_pets_pet_info p on o.pet_id = p.id
           where o.user_id = #{userId}
           and(o.order_state = 3 or o.order_state = 2)
    </select>


    <select id="findPage" resultType="com.ws.ldy.modules.yw.pets.model.vo.PetsOrderPageVO">
        select
        o.*
        ,u.full_name
        ,u.phone
        ,p.nickname as petNickname
        ,p.type as petType
        ,p.breed as petBreed
        from t_pets_order o
        left join t_pets_pet_info p on o.pet_id = p.id
        left join t_pets_user u on o.user_id = u.id
        where 1=1
        <if test="fullName != null and fullName != ''">
            and u.full_name like concat('%',#{fullName},'%')
        </if>
        <if test="phone != null and phone != ''">
            and u.phone  like concat('%',#{phone},'%')
        </if>
        <if test="orderState != null">
            and o.order_state = #{orderState}
        </if>
        <if test="orderNo != null and orderNo != ''">
            and o.order_no  like concat('%',#{orderNo},'%')
        </if>
    </select>

</mapper>

